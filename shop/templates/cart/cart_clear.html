{% extends "base.html" %}
{% load static %}

{% block title %}Clear Cart{% endblock %}

{% block content %}
<div class="container my-5" style="max-width: 900px;">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">

            <!-- Main Card -->
            <div class="card shadow border-0" style="border-radius:10px;">
                <div class="card-header bg-danger text-white text-center" style="padding:12px 0; border-radius:10px 10px 0 0;">
                    <h4 style="margin:0; font-weight:600;">
                        <i class="fas fa-trash-alt me-2"></i>Clear Your Cart
                    </h4>
                </div>

                <div class="card-body" style="padding:1.5rem;">
                    <div class="alert alert-danger mb-3" style="border-radius:6px;">
                        <h5 class="fw-bold mb-2">
                            <i class="fas fa-exclamation-triangle me-2"></i>Warning!
                        </h5>
                        <p style="margin:0;">
                            You are about to permanently remove <strong>all items</strong> from your shopping cart. 
                            This action <strong>cannot be undone</strong>.
                        </p>
                    </div>

                    <ul style="list-style:none; padding:0; margin-bottom:1rem;">
                        <li><i class="fas fa-times-circle text-danger me-2"></i>All products will be removed</li>
                        <li><i class="fas fa-times-circle text-danger me-2"></i>Saved quantities will be lost</li>
                        <li><i class="fas fa-times-circle text-danger me-2"></i>You will need to re-add items manually</li>
                        <li><i class="fas fa-times-circle text-danger me-2"></i>Action is immediate and permanent</li>
                    </ul>

                    <div class="alert alert-info mb-3" style="border-radius:6px;">
                        <h6 class="fw-bold mb-2"><i class="fas fa-lightbulb me-2"></i>Tip:</h6>
                        <ul style="margin:0; padding-left:18px; font-size:0.9rem;">
                            <li>Remove items individually instead</li>
                            <li>Update quantities to reduce items</li>
                        </ul>
                    </div>

                    <div style="border:1px solid #ffc107; background-color:#fff8e1; padding:10px; border-radius:6px; margin-bottom:1rem;">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="confirmCheck" onchange="toggleClearButton()">
                            <label class="form-check-label fw-semibold" for="confirmCheck" style="margin-left:5px;">
                                I understand this action is permanent
                            </label>
                        </div>
                    </div>

                    <form method="post" id="clearCartForm">
                        {% csrf_token %}
                        <div class="d-grid gap-2">
                            <button type="button"
                                    id="clearButton"
                                    class="btn btn-danger btn-lg"
                                    style="border-radius:6px; padding:10px; font-weight:600; opacity:0.6; cursor:not-allowed;"
                                    onclick="showFinalConfirmation()"
                                    disabled>
                                <i class="fas fa-trash-alt me-2"></i>Yes, Clear My Cart
                            </button>
                            <a href="{% url 'cart_detail' %}" 
                               class="btn btn-success btn-lg"
                               style="border-radius:6px; padding:10px; font-weight:600;">
                                <i class="fas fa-arrow-left me-2"></i>Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Safety Notice -->
            <div class="alert alert-warning mt-3" style="border-radius:6px;">
                <i class="fas fa-shield-alt me-2 text-warning"></i>
                Review your decision carefully before proceeding.
            </div>
        </div>
    </div>
</div>

<!-- Final Confirmation Modal -->
<div class="modal fade" id="finalConfirmationModal" tabindex="-1" aria-labelledby="finalConfirmationLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-danger" style="border-radius:10px;">
            <div class="modal-header bg-danger text-white" style="border-radius:10px 10px 0 0;">
                <h5 class="modal-title" id="finalConfirmationLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>Final Confirmation
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center" style="padding:1.5rem;">
                <i class="fas fa-exclamation-circle fa-3x text-danger mb-3"></i>
                <h5 class="fw-bold mb-3">This is your last chance!</h5>
                <p style="margin-bottom:1rem;">
                    Once confirmed, all items will be permanently removed.
                </p>
                <div class="alert alert-warning mb-0" style="border-radius:6px;">
                    <strong>Are you sure?</strong>
                </div>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button type="button" class="btn btn-danger" onclick="submitClearForm()">
                    <i class="fas fa-check me-2"></i>Confirm
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Toggle button state
function toggleClearButton() {
    const checkbox = document.getElementById('confirmCheck');
    const clearButton = document.getElementById('clearButton');
    if (checkbox.checked) {
        clearButton.disabled = false;
        clearButton.style.opacity = '1';
        clearButton.style.cursor = 'pointer';
    } else {
        clearButton.disabled = true;
        clearButton.style.opacity = '0.6';
        clearButton.style.cursor = 'not-allowed';
    }
}

// Show confirmation modal
function showFinalConfirmation() {
    if (!document.getElementById('clearButton').disabled) {
        const modal = new bootstrap.Modal(document.getElementById('finalConfirmationModal'));
        modal.show();
    }
}

// Submit the form
function submitClearForm() {
    document.getElementById('clearCartForm').submit();
}
</script>
{% endblock %}
